<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="club.boyuan.official.mapper.ResumeFieldValueMapper">

    <resultMap id="ResumeFieldValueResultMap" type="club.boyuan.official.entity.ResumeFieldValue">
        <id property="valueId" column="value_id"/>
        <result property="resumeId" column="resume_id"/>
        <result property="fieldId" column="field_id"/>
        <result property="fieldValue" column="field_value"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <select id="findByResumeIdAndFieldId" resultMap="ResumeFieldValueResultMap">
        SELECT * FROM resume_field_value
        WHERE resume_id = #{resumeId} AND field_id = #{fieldId}
    </select>

    <select id="findByResumeId" resultMap="ResumeFieldValueResultMap">
        SELECT * FROM resume_field_value
        WHERE resume_id = #{resumeId}
        ORDER BY value_id
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="valueId">
        INSERT INTO resume_field_value (resume_id, field_id, field_value, created_at, updated_at)
        VALUES (#{resumeId}, #{fieldId}, #{fieldValue}, NOW(), NOW())
    </insert>

    <insert id="batchInsert">
        INSERT INTO resume_field_value (resume_id, field_id, field_value, created_at, updated_at)
        VALUES
        <foreach collection="fieldValues" item="fieldValue" separator=",">
            (#{fieldValue.resumeId}, #{fieldValue.fieldId}, #{fieldValue.fieldValue}, NOW(), NOW())
        </foreach>
    </insert>

    <update id="batchUpdate">
        UPDATE resume_field_value
        SET field_value = CASE value_id
        <foreach collection="fieldValues" item="fieldValue">
            WHEN #{fieldValue.valueId} THEN #{fieldValue.fieldValue}
        </foreach>
        END,
        updated_at = NOW()
        WHERE value_id IN
        <foreach collection="fieldValues" item="fieldValue" open="(" separator="," close=")">
            #{fieldValue.valueId}
        </foreach>
    </update>

    <update id="update">
        UPDATE resume_field_value
        SET field_value = #{fieldValue}, updated_at = NOW()
        WHERE value_id = #{valueId}
    </update>

    <delete id="deleteByResumeId">
        DELETE FROM resume_field_value
        WHERE resume_id = #{resumeId}
    </delete>

    <delete id="deleteByFieldId">
        DELETE FROM resume_field_value
        WHERE field_id = #{fieldId}
    </delete>

    <delete id="deleteById">
        DELETE FROM resume_field_value
        WHERE value_id = #{valueId}
    </delete>

</mapper>